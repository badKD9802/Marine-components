<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI ë²ˆì—­ê¸°</title>
    <style>
        body { font-family: 'Suit', sans-serif; background-color: #eef2f3; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { width: 100%; max-width: 900px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        
        .translation-box { display: flex; gap: 20px; margin-bottom: 20px; }
        .box { flex: 1; display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 10px; color: #555; }
        
        textarea { 
            width: 100%; height: 250px; padding: 15px; border-radius: 10px; border: 2px solid #ddd; 
            font-size: 16px; resize: none; box-sizing: border-box; line-height: 1.6;
            transition: border-color 0.3s;
        }
        textarea:focus { outline: none; border-color: #4a90e2; }
        
        #resultText { background-color: #f8f9fa; color: #333; }
        
        .btn-area { text-align: center; }
        button { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; border: none; padding: 15px 50px; font-size: 18px; border-radius: 50px; 
            cursor: pointer; font-weight: bold; box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }

        @media (max-width: 768px) { .translation-box { flex-direction: column; } }
    </style>

    <style>
        /* ... ê¸°ì¡´ ìŠ¤íƒ€ì¼ ... */
        .auth-box {
            background: #fff3cd; border: 1px solid #ffeeba; color: #856404;
            padding: 15px; border-radius: 10px; margin-bottom: 20px;
            display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: center;
        }
        .auth-box input {
            padding: 10px; border: 1px solid #ddd; border-radius: 5px; width: 200px;
        }
    </style>

</head>

<body>
    <div class="container">
        <h1>âœ¨ AI ë²ˆì—­ê¸° & ë©”ì¼ ë¹„ì„œ</h1>

        <!-- â–¼ 1. ê³„ì • ì •ë³´ ì…ë ¥ë€ (ìƒˆë¡œ ì¶”ê°€ë¨) -->
        <div class="auth-box">
            <span>ğŸ”‘ Gmail ì„¤ì •:</span>
            <input type="email" id="myGmailId" placeholder="ë‚´ ì§€ë©”ì¼ (example@gmail.com)">
            <input type="password" id="myAppPw" placeholder="ì•± ë¹„ë°€ë²ˆí˜¸ 16ìë¦¬">
            <small style="font-size: 0.8em;">* ì €ì¥ë˜ì§€ ì•Šìœ¼ë‹ˆ ì•ˆì‹¬í•˜ì„¸ìš”.</small>
        </div>

        <!-- â–¼ 2. ë©”ì¼ ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ -->
        <div style="margin-bottom: 20px; text-align: center;">
            <button onclick="fetchEmails()" style="background: #ff9800;">ğŸ“© ë‚´ ë©”ì¼í•¨ ê°€ì ¸ì˜¤ê¸°</button>
            <div id="emailList" style="margin-top: 10px; display: none; text-align: left;"></div>
        </div>

        <!-- ... (ë²ˆì—­ê¸° ì˜ì—­ ê·¸ëŒ€ë¡œ) ... -->
        
        <!-- â–¼ 3. ë©”ì¼ ë³´ë‚´ê¸° ì˜ì—­ (ìˆ˜ì •ë¨) -->
        <div class="box" style="margin-top: 20px; border-top: 2px dashed #ddd; padding-top: 20px;">
            <h3>ğŸ“§ ë²ˆì—­ ê²°ê³¼ ì´ë©”ì¼ë¡œ ë³´ë‚´ê¸°</h3>
            <input type="email" id="targetEmail" placeholder="ë°›ì„ ì‚¬ëŒ ì´ë©”ì¼" style="width: 60%; padding: 10px;">
            <button onclick="sendEmail()" style="padding: 10px 20px; background: #28a745;">ì „ì†¡</button>
        </div>
    </div>

<script>
    // ... doTranslate í•¨ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ...

    // â˜… ë©”ì¼ ê°€ì ¸ì˜¤ê¸° (ìˆ˜ì •ë¨: ID/PW í•¨ê»˜ ì „ì†¡)
    async function fetchEmails() {
        const gmailId = document.getElementById('myGmailId').value;
        const gmailPw = document.getElementById('myAppPw').value;
        const listDiv = document.getElementById('emailList');

        if (!gmailId || !gmailPw) {
            alert("ìƒë‹¨ì˜ [Gmail ì„¤ì •]ì— ì•„ì´ë””ì™€ ì•± ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        listDiv.style.display = 'block';
        listDiv.innerHTML = "<p>ë¡œê·¸ì¸ ë° ë©”ì¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘... ğŸ“¬</p>";

        try {
            // POSTë¡œ ë³€ê²½ë¨!
            const res = await fetch('https://translation-production-ec85.up.railway.app/get-emails', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    gmail_id: gmailId, 
                    gmail_pw: gmailPw 
                })
            });
            
            const data = await res.json();
            
            if (data.error) {
                listDiv.innerHTML = `<p style="color:red;">ì—ëŸ¬: ${data.error}</p>`;
                return;
            }

            // (ëª©ë¡ ê·¸ë¦¬ëŠ” ì½”ë“œëŠ” ì´ì „ê³¼ ë™ì¼)
            let html = "";
            data.emails.forEach((mail, index) => {
                html += `
                <div onclick="selectEmail(${index})" style="background: #f1f1f1; padding: 15px; margin-bottom:10px; border-radius: 10px; cursor: pointer; border: 1px solid #ddd;">
                    <div style="font-weight: bold;">${mail.subject}</div>
                    <div style="font-size: 0.9em; color: #666;">${mail.sender}</div>
                    <input type="hidden" id="mail-body-${index}" value="${encodeURIComponent(mail.body)}">
                </div>`;
            });
            listDiv.innerHTML = html;

        } catch (e) {
            listDiv.innerHTML = "<p>ì„œë²„ í†µì‹  ì‹¤íŒ¨!</p>";
        }
    }

    // â˜… ë©”ì¼ ë³´ë‚´ê¸° (ìˆ˜ì •ë¨: ID/PW í•¨ê»˜ ì „ì†¡)
    async function sendEmail() {
        const gmailId = document.getElementById('myGmailId').value;
        const gmailPw = document.getElementById('myAppPw').value;
        const targetEmail = document.getElementById('targetEmail').value;
        const content = document.getElementById('resultText').value;

        if (!gmailId || !gmailPw) {
            alert("ìƒë‹¨ì— Gmail ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return;
        }
        if (!targetEmail || !content) {
            alert("ë°›ëŠ” ì‚¬ëŒê³¼ ë‚´ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤."); return;
        }

        if(!confirm("ì „ì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
            const response = await fetch('https://translation-production-ec85.up.railway.app/send-email', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    gmail_id: gmailId,
                    gmail_pw: gmailPw,
                    to_email: targetEmail,
                    subject: "[AI ë²ˆì—­] ê²°ê³¼ ë©”ì¼ì…ë‹ˆë‹¤.",
                    content: content
                })
            });

            const data = await response.json();
            alert(data.status);

        } catch (error) {
            alert("ì „ì†¡ ì¤‘ ì—ëŸ¬ ë°œìƒ!");
        }
    }
    
    // (selectEmail í•¨ìˆ˜ëŠ” ì´ì „ê³¼ ë™ì¼)
    function selectEmail(index) {
        const bodyInput = document.getElementById(`mail-body-${index}`).value;
        document.getElementById('inputText').value = decodeURIComponent(bodyInput);
        alert("ë‚´ìš©ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!");
    }
</script>
</body>
</html>